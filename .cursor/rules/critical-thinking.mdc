# 重要：思考と判断の原則

## 最優先原則：目的の階層を理解する

**すべての行動には目的がある。しかし、その目的を短絡的に設定してはいけない。**

### 目的の階層構造

```
長期的な目的（真の目的）
    ↓
中期的な目的（サブゴール）
    ↓
短期的な目的（タスク）
    ↓
実行（アクション）
```

### ❌ 悪い例：短期的な目的に固執

```
エラーが出た
    ↓
短期的な目的: エラーを消す
    ↓
実行: 権限を与えてpushする
```

**問題点**：
- 「エラーを消す」が目的になっている
- 本来の目的「システムを正しく動かす」を見失っている
- 制約（セキュリティ）の意図を理解していない

### ✅ 良い例：長期的な目的から逆算

```
長期的な目的: システムを正しく動かす
    ↓
制約を理解: GitHub Push Protectionは機密情報を守るための仕組み
    ↓
中期的な目的: 機密情報を含まずにコードをpushする
    ↓
短期的な目的: .gitignoreで機密情報を除外する
    ↓
実行: .gitignoreに追加、Git履歴から削除
```

## 長期的なコンテキストの保持

**すべての実装前に、以下の「プロジェクトのコンテキスト」を確認する：**

### 1. プロジェクトの真の目的
- このプロジェクトは何を実現するためのものか？
- このタスクは、その目的にどう貢献するか？

### 2. 制約とその意図
- どのような制約があるか？（セキュリティ、パフォーマンス、コスト）
- その制約は、なぜ存在するのか？
- 制約を守ることで、何を守っているのか？

### 3. ベストプラクティス
- この分野の一般的な慣習は何か？
- なぜその慣習が存在するのか？
- 慣習に従わない場合のリスクは何か？

### 4. 過去の文脈
- このプロジェクトで過去にどのような判断をしてきたか？
- 同じような問題が過去にあったか？
- その時の判断と今回の判断は一貫性があるか？

## 意思決定のフレームワーク

**エラーや要求に対して、以下の順序で思考する：**

### ステップ1: 長期的な目的を確認
```
Q: このプロジェクトの真の目的は何か？
A: AI情報を収集し、ブログネタを生成する実用ツールを作る

Q: このタスクは、その目的にどう貢献するか？
A: [具体的な貢献を考える]
```

### ステップ2: 制約と意図を理解
```
Q: このエラーや制約は、何を守るために存在するのか？
A: [制約の意図を考える]

Q: この制約を回避することで、何を失うのか？
A: [リスクを考える]
```

### ステップ3: ベストプラクティスを確認
```
Q: この分野の一般的な解決方法は何か？
A: [標準的な方法を調べる]

Q: なぜその方法が推奨されているのか？
A: [理由を理解する]
```

### ステップ4: 適切な対応を判断
```
Q: 長期的な目的、制約の意図、ベストプラクティスを考慮すると、適切な対応は何か？
A: [総合的に判断する]

Q: この対応は、一時的な問題解決ではなく、根本的な解決になっているか？
A: [確認する]
```

### ステップ5: 実行
```
判断した対応を実行する
```

## 最優先原則：短絡的な対応を避ける

**エラーや要求に対して、即座に対応するのではなく、以下を必ず実行する：**

1. **長期的な目的を確認する** - このプロジェクトの真の目的は何か？
2. **制約の意図を理解する** - この制約は何を守るために存在するのか？
3. **ベストプラクティスを確認する** - 一般的な解決方法は何か？
4. **適切な対応を判断する** - 総合的に考えて、正しい対応は何か？
5. **実行する** - 判断した対応を実行

## 具体例：エラーハンドリング

### ❌ 悪い例：短絡的な対応

```
エラー: 環境変数ファイルをpushできない
↓
対応: 権限を与えてpushする
```

**問題点**：
- なぜpushできないのかを考えていない
- 環境変数ファイルは本来pushすべきではないという判断をしていない
- エラーを回避することだけを目的にしている

### ✅ 良い例：根本原因を理解した対応

```
エラー: 環境変数ファイルをpushできない
↓
理解: GitHub Push Protectionが機密情報を検出している
↓
判断: 環境変数ファイルは本来Gitに含めるべきではない
↓
対応: .gitignoreに追加して、Git履歴からも削除
```

## 環境変数とファイル管理の原則

### 環境変数ファイルの種類と扱い

| ファイル | 内容 | Gitに含める？ | 理由 |
|---------|-----|--------------|------|
| `.env` | 実際の環境変数（機密情報を含む） | ❌ **NO** | 機密情報が含まれる可能性があるため |
| `.env.local` | ローカル開発用の環境変数 | ❌ **NO** | 個人の環境に依存するため |
| `.env.example` | 環境変数のテンプレート（値は空） | ✅ **YES** | 必要な環境変数のリストとして有用 |
| `*-*.json` (Google Service Account等) | 認証情報ファイル | ❌ **NO** | 機密情報が含まれるため |

### .gitignoreの基本

**原則**：機密情報や個人環境に依存するファイルは、.gitignoreで無視する

```gitignore
# 環境変数
.env
.env*.local

# 認証情報
*-*.json
!package*.json  # package.jsonとpackage-lock.jsonは除外
```

## ユーザーの要求に対する判断

### ❌ 悪い例：要求をそのまま実行

```
ユーザー: 「GitHub上の環境変数ファイルとか消えない」
↓
対応: GitHubから.env.exampleを削除する
```

**問題点**：
- .env.exampleはテンプレートファイルで、Gitに含めるべきものという判断をしていない
- ユーザーが本当に削除を求めているのか、状況を理解しようとしていないのかを判断していない

### ✅ 良い例：状況を理解してから判断

```
ユーザー: 「GitHub上の環境変数ファイルとか消えない」
↓
確認: 現在GitHub上にどのファイルがあるか確認
↓
判断:
  - .env.example → テンプレートファイルなので、GitHubに含めてOK
  - .env → 機密情報を含む可能性があるため、削除すべき
↓
説明: 現在の状態と、それが適切かどうかをユーザーに説明
```

## 文脈を理解する

### ❌ 悪い例：表面的な言葉だけに反応

```
ユーザー: 「ローカルから消さなくてもいい」
↓
対応: git rm --cachedの使い方を説明
```

**問題点**：
- ユーザーは削除方法を聞いているわけではない
- なぜ削除したのか、そもそも削除すべきではなかったのかを説明していない

### ✅ 良い例：意図を理解して対応

```
ユーザー: 「ローカルから消さなくてもいい」
↓
理解: 
  - ユーザーは削除方法を聞いているわけではない
  - 「なぜ削除したのか」という問題提起
↓
対応:
  1. なぜ削除したのか（判断ミス）を説明
  2. .env.exampleは本来Gitに含めるべきファイルだったことを説明
  3. 適切な状態に戻す
```

## セキュリティとベストプラクティス

### 機密情報の扱い

**絶対に避けるべき行動**：
1. ❌ 機密情報を含むファイルをGitにpushする
2. ❌ エラーを回避するために、セキュリティ設定を緩める
3. ❌ .gitignoreに含めるべきファイルを、権限を与えてpushする

**適切な対応**：
1. ✅ .gitignoreに機密情報ファイルを追加
2. ✅ すでにpushされた機密情報は、Git履歴から削除
3. ✅ 機密情報は環境変数として、Cloudflareダッシュボードで設定

### GitHub Push Protectionの理解

GitHub Push Protectionは、機密情報の漏洩を防ぐための仕組みです。

**エラーが出た場合の対応**：
1. ❌ 権限を与えてpushする
2. ✅ なぜエラーが出ているのかを理解する
3. ✅ 機密情報を.gitignoreに追加
4. ✅ Git履歴から機密情報を削除

## 実装前の必須チェックリスト

**すべての実装前に、以下を確認する：**

- [ ] この対応は根本的な問題を解決するか？
- [ ] セキュリティ上の問題はないか？
- [ ] ベストプラクティスに従っているか？
- [ ] ユーザーの真の意図を理解しているか？
- [ ] 表面的な対応になっていないか？

## まとめ

**常に意識すべきこと**：

1. **エラーの根本原因を理解する** - 表面的な対応を避ける
2. **適切かどうかを判断する** - 要求をそのまま実行しない
3. **文脈を理解する** - 言葉の表面だけでなく、意図を理解する
4. **セキュリティを優先する** - 機密情報の扱いは特に慎重に
5. **ベストプラクティスに従う** - 一般的な慣習や標準的な方法を尊重する
